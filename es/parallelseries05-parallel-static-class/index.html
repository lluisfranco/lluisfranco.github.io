<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Parallel Series 05 - Parallel Static Class - &gt;_lluis franco</title><meta name="Description" content="home/lluisfranco/code/tips/"><meta property="og:title" content="Parallel Series 05 - Parallel Static Class" />
<meta property="og:description" content="Ir al índice de la serie
Parallel Static Class Hoy quiero hablaros de la clase estática Parallel. Esta clase provee soporte para paralelizar bucles y regiones, y al igual que PLINQ su uso es muy sencillo. Cabe destacar que está especialmente optimizada para iteraciones, y que en este contexto se desenvuelve un poco mejor que PLINQ. No hay una diferencia significativa en tiempos absolutos, pero puede verse perfectamente si utilizamos el magnífico profiler de Visual Studio 2010." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lluisfranco.com/es/parallelseries05-parallel-static-class/" />
<meta property="article:published_time" content="2011-06-26T11:51:50+02:00" />
<meta property="article:modified_time" content="2011-06-26T11:51:50+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Parallel Series 05 - Parallel Static Class"/>
<meta name="twitter:description" content="Ir al índice de la serie
Parallel Static Class Hoy quiero hablaros de la clase estática Parallel. Esta clase provee soporte para paralelizar bucles y regiones, y al igual que PLINQ su uso es muy sencillo. Cabe destacar que está especialmente optimizada para iteraciones, y que en este contexto se desenvuelve un poco mejor que PLINQ. No hay una diferencia significativa en tiempos absolutos, pero puede verse perfectamente si utilizamos el magnífico profiler de Visual Studio 2010."/>
<meta name="application-name" content="&gt;_lluis franco">
<meta name="apple-mobile-web-app-title" content="&gt;_lluis franco"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/myAvatar.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://lluisfranco.com/es/parallelseries05-parallel-static-class/" /><link rel="prev" href="https://lluisfranco.com/es/parallelseries04-plinq/" /><link rel="next" href="https://lluisfranco.com/es/luces-camara-action/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Parallel Series 05 - Parallel Static Class",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/lluisfranco.com\/es\/parallelseries05-parallel-static-class\/"
        },"genre": "posts","keywords": "csharp, net framework, Task, Parallel, Async","wordcount":  1381 ,
        "url": "https:\/\/lluisfranco.com\/es\/parallelseries05-parallel-static-class\/","datePublished": "2011-06-26T11:51:50+02:00","dateModified": "2011-06-26T11:51:50+02:00","publisher": {
            "@type": "Organization",
            "name": "Lluis Franco"},"author": {
                "@type": "Person",
                "name": "lluís"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/es/" title="&gt;_lluis franco"><span class="header-title-pre"><i class='fas fa-terminal'></i></span>lluis franco</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/es/about/"> About </a><a class="menu-item" href="/es/posts/"> Posts </a><a class="menu-item" href="/es/tags/"> Tags </a><a class="menu-item" href="/es/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">Spanish<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/es/parallelseries05-parallel-static-class/" selected>Spanish</option></select>
                    </a><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Busca títulos o contenido..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Buscar">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Limpiar">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/es/" title="&gt;_lluis franco"><span class="header-title-pre"><i class='fas fa-terminal'></i></span>lluis franco</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Busca títulos o contenido..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Buscar">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Limpiar">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancelar
                    </a>
                </div><a class="menu-item" href="/es/about/" title="">About</a><a class="menu-item" href="/es/posts/" title="">Posts</a><a class="menu-item" href="/es/tags/" title="">Tags</a><a class="menu-item" href="/es/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">Spanish<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/es/parallelseries05-parallel-static-class/" selected>Spanish</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Parallel Series 05 - Parallel Static Class</h1><h2 class="single-subtitle">3 métodos para los reyes elfos bajo el cielo</h2><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/about/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>lluís</a></span>&nbsp;<span class="post-category">incluido en <a href="/es/categories/development/"><i class="far fa-folder fa-fw"></i>Development</a>&nbsp;<a href="/es/categories/parallel-series/"><i class="far fa-folder fa-fw"></i>Parallel Series</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2011-06-26">2011-06-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1381 palabras&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;7 minutos&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/posts/ParallelStaticClass.png"
        data-srcset="/images/posts/ParallelStaticClass.png, /images/posts/ParallelStaticClass.png 1.5x, /images/posts/ParallelStaticClass.png 2x"
        data-sizes="auto"
        alt="/images/posts/ParallelStaticClass.png"
        title="/images/posts/ParallelStaticClass.png" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#parallel-static-class">Parallel Static Class</a>
      <ul>
        <li><a href="#comprendiendo-las-acciones">Comprendiendo las acciones</a></li>
        <li><a href="#el-método-parallelfor">El método Parallel.For</a></li>
        <li><a href="#so-lets-parallelize">So, let’s parallelize</a></li>
        <li><a href="#el-método-parallelforeach">El método Parallel.ForEach</a></li>
        <li><a href="#explorando-más-opciones">Explorando más opciones</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><a href="/es/parallelseries00-index" rel="">Ir al índice de la serie</a></p>
<h2 id="parallel-static-class">Parallel Static Class</h2>
<p>Hoy quiero hablaros de la <a href="http://msdn.microsoft.com/en-us/library/system.threading.tasks.parallel.aspx" target="_blank" rel="noopener noreffer">clase estática Parallel</a>. Esta clase provee soporte para paralelizar bucles y regiones, y al igual que PLINQ su uso es muy sencillo. Cabe destacar que está especialmente optimizada para iteraciones, y que en este contexto se desenvuelve un poco mejor que PLINQ. No hay una diferencia significativa en tiempos absolutos, pero puede verse perfectamente si utilizamos el magnífico profiler de Visual Studio 2010. No obstante, pueden existir situaciones en las que si se necesita afinar mucho el rendimiento en iteraciones, y aquí es dónde tiene más sentido utilizar dos de los tres métodos de esta clase: <strong>For</strong> y <strong>ForEach</strong>. Al tercero lo llamaremos Cirdan y apenas aparecerá en esta historia (en realidad me refiero a Invoke pero tampoco aparecerá por aquí).</p>
<h3 id="comprendiendo-las-acciones">Comprendiendo las acciones</h3>
<p>Los dos métodos tienen una firma muy similar en su forma más sencilla. Ambos iteran sobre una serie de instrucciones realizando n veces cada una de ellas. Y aquí es dónde vemos aparecer los parámetros de tipo Action:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">static</span> <span class="n">ParallelLoopResult</span> <span class="n">For</span>
    <span class="p">(</span><span class="kt">int</span> <span class="n">fromInclusive</span><span class="p">,</span> <span class="kt">int</span> <span class="n">toExclusive</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">body</span><span class="p">)</span>
<span class="k">public</span> <span class="k">static</span> <span class="n">ParallelLoopResult</span> <span class="n">ForEach</span><span class="p">&lt;</span><span class="n">TSource</span><span class="p">&gt;</span>
    <span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TSource</span><span class="p">&gt;</span> <span class="n">source</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">TSource</span><span class="p">&gt;</span> <span class="n">body</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Un Action<T>, al igual que su hermano Func<T> es uno de los elementos de C# importados de la <a href="/es/functional-programming-for-the-rest-of-us/" rel="">programación funcional</a>, y desde el momento en que uno se acostumbra a usarlo, cuesta pensar cómo ha podido desarrollar toda su vida anterior. Si no, los que estéis acostumbrados a usar expresiones lambda en LINQ, imagináos que desaparecen de un día para otro.</p>
<p>No quiero empezar a divagar ahora sobre programación funcional, aunque si que quiero hacer incapié en el uso de Actions y lo importantes que se han vuelto en los últimos años. De hecho, recientemente <a href="/es/luces-camara-action/" rel="">he dedicado un post</a> a cómo Action y Func han simplificado mucho el trabajo con delegados a los desarrolladores.</p>
<h3 id="el-método-parallelfor">El método Parallel.For</h3>
<p>Pero volviendo al tema que nos ocupa, si observamos la firma del método <strong>Parallel</strong>.For podremos ver que en lo importante no difiere demasiado de su homólogo <strong>for</strong> de toda la vida: Ambos tienen un inicio, un final y unas acciones a realizar un número determinado de veces.</p>
<p>Así que partiendo del método IsPrime que ya utilizamos en el <a href="/es/parallelseries04-plinq" rel="">anterior post sobre PLINQ</a>, vamos a ver una comparativa entre las sintaxis de éstos dos métodos:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">100</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">IsPrime</span><span class="p">())</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&#34;{0} es primo&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
    <span class="k">else</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&#34;{0} no es primo&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">Parallel</span><span class="p">.</span><span class="n">For</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">IsPrime</span><span class="p">())</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&#34;{0} es primo&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
        <span class="k">else</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&#34;{0} no es primo&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
    <span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
<p>En ambos  casos tenemos una serie de líneas que deben ejecutarse 100 veces. Concretamente desde 0 hasta 99, ya que el elemento superior no se incluye en ninguno de los dos casos. Sólo se ve un poco extraño el uso del Action<T>, pero podéis pensar en que la variable int i del primer bucle for, aquí se transforma en la parte (i) a la izquierda de la expresión lambda (=&gt;). Y las acciones a ejecutar del primer for son exactamente iguales y van a la derecha de la expresión lambda.</p>
<h3 id="so-lets-parallelize">So, let’s parallelize</h3>
<p>Viéndolo de este modo debe resultar extremadamente sencillo transformar todos nuestros bucles de este modo, así que ¿debemos hacerlo? La respuesta es NO.</p>
<p>En algunas ocasiones no vamos a obtener rendimiento por el hecho de paralelizar, ya que si el trabajo a realizar es mínimo, tardaremos más tiempo en dividir el trabajo en distintos threads, ejecutarlos y consolidar la información que en ejecutar la tarea sin paralelizar. También podría ser que nos encontrásemos un cuello de botella externo en un dispositivo de I/O, como un puerto, un servidor remoto o un socket.</p>
<p>Otro claro ejemplo de esto son los bucles anidados. Es común anidar varias estructuras for o foreach para realizar ciertos algoritmos. En este caso el candidato a ser paralelizado siempre es el bucle exterior y no es necesario (de hecho sería contraproducente) paralelizar los bucles internos:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">Parallel</span><span class="p">.</span><span class="n">For</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">100</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">IsPrime</span><span class="p">())</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&#34;{0} es primo&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
            <span class="k">else</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&#34;{0} no es primo&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Por lo pronto resulta bastante evidente, ya que si paralelizamos en bucle exterior necesitaríamos un ordenador con 100 cores y evidentementemente todavía no existen, así que la TPL tiene que agrupar estas tareas para adaptarlas a los cores disponibles, tardando cierto tiempo en hacer la sincronización (parecido a los <a href="/es/parallelseries02-un-poco-de-historia" rel="">primeros ejemplos con monos de la serie</a>). Imagináos entonces si paralelizamos ambos bucles: 100 x 100 = 10.000 cores? Simplemente no tiene sentido.</p>
<p>Mi consejo es que en todos los casos en los que se decida paralelizar un bucle (y esto también vale para las consultas PLINQ) se realice primero una comparativa de rendimiento.</p>
<figure>
    <img src="/images/posts/parallelfor_profiling.png"/> <figcaption>
            <h4>Tu amigo el profiler no engaña ;)</h4>
        </figcaption>
</figure>

<h3 id="el-método-parallelforeach">El método Parallel.ForEach</h3>
<p>En cuanto al método ForEach es prácticamente igual al anterior con la salvedad que no tenemos un inicio y un final, sino una secuencia de entrada de datos (basada en IEnumerable, como PLINQ) y una variable que usamos para iterar por cada uno de los elementos de la secuencia y realizar una serie de acciones.</p>
<p>Consideremos el siguiente código:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">List</span><span class="p">&lt;</span><span class="n">FeedDefinition</span><span class="p">&gt;</span> <span class="n">feeds</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">FeedDefinition</span><span class="p">&gt;();</span>
<span class="n">clock</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">blogs</span> <span class="p">=</span> <span class="n">FeedsEngine</span><span class="p">.</span><span class="n">GetBlogsUrls</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">blog</span> <span class="k">in</span> <span class="n">blogs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">feeds</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">FeedsEngine</span><span class="p">.</span><span class="n">GetBlogFeeds</span><span class="p">(</span><span class="n">blog</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">clock</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">clock</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&#34;n2&#34;</span><span class="p">);</span>
<span class="n">feeds</span><span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Suponiendo que tenemos un método FeedsEngine.GetBlogsUrls que devuelve una lista de urls de proporcionan contenido RSS, el código anterior se conecta a cada una de las urls e intenta descargar toda la información de los posts mediante un método FeedsEngine.GetBlogFeeds(blog).</p>
<blockquote>
<p>Nota: El código completo lo podréis encontrar en el post (todavía no publicado) ‘Código de ejemplo de las Parallel Series’, que contiene todos los ejemplos de todos los posts de la serie.</p>
</blockquote>
<p>Como podéis imaginar este proceso totalmente secuencial es un serio candidato a ser paralelizado, ya que la mayoría del tiempo de este proceso es tiempo desperdiciado intentando a conectar con un servidor externo y que éste responda a las peticiones. En este caso paralelizar va a ser de gran ayuda aunque es importante comprender que en este caso la ganancia de rendimiento no va a ser por usar más potencia local, sino por lanzar las peticiones a los distintos servidores de forma asíncrona.</p>
<p>Así pues, basta cambiar la parte del bucle foreach por su versión paralelizada:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">Parallel</span><span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">blogs</span><span class="p">,</span> <span class="p">(</span><span class="n">blog</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">feeds</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">FeedsEngine</span><span class="p">.</span><span class="n">GetBlogFeeds</span><span class="p">(</span><span class="n">blog</span><span class="p">));</span>
    <span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
<p>En la que definimos la secuencia de datos a utilizar y declaramos la variable blog al vuelo (el compilador infiere el tipo automáticamente) a la izquierda de la expresión lambda, y a la derecha las acciones que deseamos realizar, que son exactamente iguales a la anterior versión foreach.</p>
<p>Y comprobaremos como se ejecuta mucho más rápido. En mi estación de trabajo pasamos de 6,7 segundos a 1,4 lo que no está nada mal.</p>
<h3 id="explorando-más-opciones">Explorando más opciones</h3>
<p>En la clase Parallel al igual que en las consultas PLINQ, existe la posibilidad de especificar el grado de paralelismo así como de cancelar la ejecución de un bucle. Sólo debemos usar una de las sobrecargas que utiliza un objeto de tipo <a href="http://msdn.microsoft.com/en-us/library/system.threading.tasks.paralleloptions.aspx" target="_blank" rel="noopener noreffer">ParallelOptions</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="n">button11_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CancellationTokenSource</span> <span class="n">cs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CancellationTokenSource</span><span class="p">();</span>
    <span class="kt">var</span> <span class="n">cores</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="n">ProcessorCount</span><span class="p">;</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>
    <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ParallelOptions</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">MaxDegreeOfParallelism</span> <span class="p">=</span> <span class="n">cores</span> <span class="p">/</span> <span class="m">2</span><span class="p">,</span>
        <span class="n">CancellationToken</span><span class="p">=</span> <span class="n">cs</span><span class="p">.</span><span class="n">Token</span> <span class="p">};</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">Parallel</span><span class="p">.</span><span class="n">For</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span>
            <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">dowork_cancel</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cs</span><span class="p">);</span>
            <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">clock</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&#34;n2&#34;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">void</span> <span class="n">dowork_cancel</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">CancellationTokenSource</span> <span class="n">cs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">==</span> <span class="m">5</span><span class="p">)</span> <span class="n">cs</span><span class="p">.</span><span class="n">Cancel</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>En el caso anterior especificamos un grado de paralelización de la mitad del número de cores y preparemos la consulta para su posible cancelación (algo que simulamos en el interior del método dowork_cancel al llegar el contador a 5).</p>
<p>A continución&hellip;</p>
<p>En el <a href="/es/parallelseries06-task-class" rel="">próximo post</a> veremos cómo utilizar la clase Task para crear, ejecutar, encadenar y gestionar tareas de forma asíncrona.</p>
<p><a href="/es/parallelseries00-index" rel="">Ir al índice de la serie</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Actualizado el 2011-06-26</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/es/parallelseries05-parallel-static-class/index.md" target="_blank">Leer Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://lluisfranco.com/es/parallelseries05-parallel-static-class/" data-title="Parallel Series 05 - Parallel Static Class" data-via="lluisfranco" data-hashtags="csharp,net framework,Task,Parallel,Async"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://lluisfranco.com/es/parallelseries05-parallel-static-class/" data-hashtag="csharp"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://lluisfranco.com/es/parallelseries05-parallel-static-class/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://lluisfranco.com/es/parallelseries05-parallel-static-class/" data-title="Parallel Series 05 - Parallel Static Class" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Pinterest" data-sharer="pinterest" data-url="https://lluisfranco.com/es/parallelseries05-parallel-static-class/" data-image="/images/posts/ParallelStaticClass.png"><i class="fab fa-pinterest fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://lluisfranco.com/es/parallelseries05-parallel-static-class/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://lluisfranco.com/es/parallelseries05-parallel-static-class/" data-title="Parallel Series 05 - Parallel Static Class" data-description=""><i data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></i></a><a href="javascript:void(0);" title="Compartir en Pocket" data-sharer="pocket" data-url="https://lluisfranco.com/es/parallelseries05-parallel-static-class/"><i class="fab fa-get-pocket fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Evernote" data-sharer="evernote" data-url="https://lluisfranco.com/es/parallelseries05-parallel-static-class/" data-title="Parallel Series 05 - Parallel Static Class"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/es/tags/csharp/">csharp</a>,&nbsp;<a href="/es/tags/net-framework/">net framework</a>,&nbsp;<a href="/es/tags/task/">Task</a>,&nbsp;<a href="/es/tags/parallel/">Parallel</a>,&nbsp;<a href="/es/tags/async/">Async</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/es/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/es/parallelseries04-plinq/" class="prev" rel="prev" title="Parallel Series 04 - PLINQ"><i class="fas fa-angle-left fa-fw"></i>Parallel Series 04 - PLINQ</a>
            <a href="/es/luces-camara-action/" class="next" rel="next" title="Luces, cámara... action!">Luces, cámara... action!<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "lluisfrancoblog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/about/" target="_blank">lluís</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.es.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":20},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/es/index.json","lunrLanguageCode":"es","maxResultLength":10,"noResultsFound":"No se encontraron resultados","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
