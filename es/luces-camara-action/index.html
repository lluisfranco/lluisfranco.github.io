<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Luces, c√°mara... action! - &gt;_lluis franco</title>
        <meta name="Description" content="home/lluisfranco/code/tips/"><meta property="og:title" content="Luces, c√°mara... action!" />
<meta property="og:description" content="Ir al √≠ndice de la serie
Magia sin delegados Los delegados de tipo Action son una de las peque√±as maravillas tra√≠das a .NET desde la programaci√≥n funcional. Pueden definirse como un m√©todo que tiene un s√≥lo par√°metro (en su sobrecarga m√°s simple) y que no devuelve ning√∫n valor. Habitualmente suelen usarse para almacenar referencias a m√©todos o para pasar un m√©todo como par√°metro sin tener que declarar expl√≠citamente un delegado. Basta definir el par√°metro con la misma firma que se espera recibir y la magia empieza a actuar." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lluisfranco.github.io/es/luces-camara-action/" />
<meta property="article:published_time" content="2012-02-08T11:51:50+02:00" />
<meta property="article:modified_time" content="2012-02-08T11:51:50+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Luces, c√°mara... action!"/>
<meta name="twitter:description" content="Ir al √≠ndice de la serie
Magia sin delegados Los delegados de tipo Action son una de las peque√±as maravillas tra√≠das a .NET desde la programaci√≥n funcional. Pueden definirse como un m√©todo que tiene un s√≥lo par√°metro (en su sobrecarga m√°s simple) y que no devuelve ning√∫n valor. Habitualmente suelen usarse para almacenar referencias a m√©todos o para pasar un m√©todo como par√°metro sin tener que declarar expl√≠citamente un delegado. Basta definir el par√°metro con la misma firma que se espera recibir y la magia empieza a actuar."/>
<meta name="application-name" content="&gt;_lluis franco">
<meta name="apple-mobile-web-app-title" content="&gt;_lluis franco"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/myAvatar.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://lluisfranco.github.io/es/luces-camara-action/" /><link rel="prev" href="https://lluisfranco.github.io/es/parallelseries05-parallel-static-class/" /><link rel="next" href="https://lluisfranco.github.io/es/functional-programming-for-the-rest-of-us/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.es.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Luces, c√°mara... action!",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/lluisfranco.github.io\/es\/luces-camara-action\/"
        },"image": {
                "@type": "ImageObject",
                "url": "https:\/\/lluisfranco.github.io\/images\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "csharp, net framework, Task, Parallel, Async","wordcount":  1274 ,
        "url": "https:\/\/lluisfranco.github.io\/es\/luces-camara-action\/","datePublished": "2012-02-08T11:51:50+02:00","dateModified": "2012-02-08T11:51:50+02:00","publisher": {
                "@type": "Organization",
                "name": "Lluis Franco",
                "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/lluisfranco.github.io\/images\/myAvatar200.png",
                "width":  127 ,
                "height":  40 
                }
            },"author": {
                "@type": "Person",
                "name": "llu√≠s"
            },"description": ""
    }
    </script></head>
    <body><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/es/" title="&gt;_lluis franco"><span class="header-title-pre"><i class='fas fa-terminal'></i></span>lluis franco</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/es/about/"> About </a><a class="menu-item" href="/es/posts/"> Posts </a><a class="menu-item" href="/es/tags/"> Tags </a><a class="menu-item" href="/es/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Selecciona el lenguage">Spanish<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/es/luces-camara-action/" selected>Spanish</option></select>
                    </a><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Busca t√≠tulos o contenido..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Buscar">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Limpiar">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/es/" title="&gt;_lluis franco"><span class="header-title-pre"><i class='fas fa-terminal'></i></span>lluis franco</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Busca t√≠tulos o contenido..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Buscar">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Limpiar">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancelar
                    </a>
                </div><a class="menu-item" href="/es/about/" title="">About</a><a class="menu-item" href="/es/posts/" title="">Posts</a><a class="menu-item" href="/es/tags/" title="">Tags</a><a class="menu-item" href="/es/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Selecciona el lenguage">Spanish<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/es/luces-camara-action/" selected>Spanish</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contenido</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Luces, c√°mara... action!</h1><h2 class="single-subtitle">Delegados sin delegados</h2><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/about/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>llu√≠s</a></span>&nbsp;
                    <span class="post-category">incluido en<a href="/es/categories/development/">
                                <i class="far fa-folder fa-fw"></i>Development
                            </a>&nbsp;<a href="/es/categories/parallel-series/">
                                <i class="far fa-folder fa-fw"></i>Parallel Series
                            </a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2012-02-08>2012-02-08</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>unas 1274 palabras&nbsp;
                <i class="far fa-clock fa-fw"></i>6 min&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading/normal.min.svg"
        data-src="/images/posts/LightsCameraAction.png"
        data-srcset="/images/posts/LightsCameraAction.png, /images/posts/LightsCameraAction.png 1.5x, /images/posts/LightsCameraAction.png 2x"
        data-sizes="auto"
        alt="/images/posts/LightsCameraAction.png"
        title="/images/posts/LightsCameraAction.png" /></div><div class="details toc" id="toc-static">
                <div class="details-summary toc-title">
                    <span>Contenido</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#magia-sin-delegados">Magia sin delegados</a></li>
    <li><a href="#actions-por-todos-lados">Actions por todos lados</a></li>
    <li><a href="#ahora-con-par√°metros">Ahora con par√°metros</a></li>
    <li><a href="#resumiendo">Resumiendo</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><a href="/es/parallelseries00-index" rel="">Ir al √≠ndice de la serie</a></p>
<h2 id="magia-sin-delegados">Magia sin delegados</h2>
<p>Los delegados de tipo <a href="http://msdn.microsoft.com/en-us/library/018hxwa8.aspx" target="_blank" rel="noopener noreffer">Action</a> son una de las peque√±as maravillas tra√≠das a .NET desde la programaci√≥n funcional. Pueden definirse como un m√©todo que tiene un s√≥lo par√°metro (en su sobrecarga m√°s simple) y que no devuelve ning√∫n valor. Habitualmente suelen usarse para almacenar referencias a m√©todos o para pasar un m√©todo como par√°metro sin tener que declarar expl√≠citamente un delegado. Basta definir el par√°metro con la misma firma que se espera recibir y la magia empieza a actuar.</p>
<p>Un detalle importante que podemos ver al observar la firma de Action<T> es que el tipo T es contravariante, de modo que podemos usar este tipo en cualquier otro tipo derivado.  Si quieres saber m√°s sobre <a href="http://msdn.microsoft.com/en-us/library/dd799517.aspx" target="_blank" rel="noopener noreffer">covarianza y contravarianza en Generics</a> dale un buen vistazo a <a href="https://www.eiximenis.dev/posts/2010-11-18-c-bsico-covarianza-en-genricos/" target="_blank" rel="noopener noreffer">este post</a> del blog del colega Eduard Tom√†s.</p>
<p>Veamos un poco de esta magia. Suponiendo que tenemos un m√©todo que admite un par√°metro de tipo Action<string> podemos llamar al m√©todo y pasarle (o m√°s bien inyectarle) el comportamiento deseado, es decir pasarle un m√©todo que cumpla con la firma por par√°metro:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">void</span> <span class="n">test</span><span class="p">()</span>
<span class="p">{</span>
     <span class="kt">string</span> <span class="n">msg</span> <span class="p">=</span> <span class="s">&#34;This is the value...&#34;</span><span class="p">;</span>
     <span class="n">doSomethingWithStringValue</span><span class="p">(</span><span class="n">enqueueMessage</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
     <span class="n">doSomethingWithStringValue</span><span class="p">(</span><span class="n">saveToDatabase</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
     <span class="n">doSomethingWithStringValue</span><span class="p">(</span><span class="n">writeMessageToConsole</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="k">private</span> <span class="k">void</span> <span class="n">doSomethingWithStringValue</span><span class="p">(</span><span class="n">Action</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">actionToDo</span><span class="p">,</span> <span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
<span class="p">{</span>
     <span class="c1">//do several things with this value
</span><span class="c1"></span>     <span class="n">validateMessage</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
     <span class="n">compressMessage</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
     <span class="c1">//when finishing...
</span><span class="c1"></span>     <span class="n">actionToDo</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="k">private</span> <span class="k">void</span> <span class="n">enqueueMessage</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
<span class="p">{</span>
     <span class="c1">//do something &amp; enqueue this value
</span><span class="c1"></span>     <span class="n">Queue</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">messages</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Queue</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
     <span class="n">messages</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="k">private</span> <span class="k">void</span> <span class="n">saveToDatabase</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
<span class="p">{</span>
     <span class="c1">//do something &amp; save to db this value
</span><span class="c1"></span>     <span class="n">addLineToUserLog</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="k">private</span> <span class="k">void</span> <span class="n">writeMessageToConsole</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
<span class="p">{</span>
     <span class="c1">//do something &amp; output this value
</span><span class="c1"></span>     <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Por un lado tenemos tres m√©todos que hacen cosas distintas pero tienen la misma firma (todos esperan un par√°metro de tipo string). Y por el otro tenemos un m√©todo que tiene un par√°metro de tipo Action<string>. Es decir, este par√°metro admite como valor cualquier m√©todo que tenga la misma firma que hemos declarado. De este modo, podemos invocarlo varias veces y en cada una de ellas de podemos decir que utilice un m√©todo distinto para hacer algo distinto. Muy similar a las funciones as√≠ncronas de Javascript o al patr√≥n <a href="http://wiki.commonjs.org/wiki/Promises/A" target="_blank" rel="noopener noreffer">Promise</a>.</p>
<p>Bonito, eh? Es lo mismo que utilizar delegados pero, uhm‚Ä¶ espera! Si, sin usarlos üòÑ</p>
<h2 id="actions-por-todos-lados">Actions por todos lados</h2>
<p>Pues cada vez son m√°s las clases del framework que hacen uso de este tipo de delegados y de su hermano Func, que viene a ser lo mismo pero retornando un valor. Sin ir m√°s lejos, los m√©todos extensores de LINQ (Select, Where, OrderBy) utilizan Func y casi toda la TPL se basa en el uso de Action, desde los bucles For y ForEach de la clase est√°tica Parallel, hasta la creaci√≥n expl√≠cita de tareas mediante la clase Task.</p>
<p>Por ejemplo, cuando deseamos ejecutar una tarea de forma as√≠ncrona, podemos utilizar el m√©todo StartNew de la clase Task.Factory. Este m√©todo tiene una sobrecarga en el que acepta un par√°metro de tipo Action o Func, y lo mejor de todo es que puede crearse inline (en l√≠nea), es decir en el mismo momento en que se realiza la llamada. Veamos unos ejemplos:</p>
<p>Partiendo de un m√©todo simple:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="n">doSomething</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//Pause for 0 to 10 seconds (random)
</span><span class="c1"></span>    <span class="n">Random</span> <span class="n">r</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Random</span><span class="p">(</span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">().</span><span class="n">GetHashCode</span><span class="p">());</span>
    <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="m">10000</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Puesto que es un m√©todo que ni recibe par√°metros ni devuelve nada podemos llegar a utilizar su sobrecarga m√°s sencilla:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">Task</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">StartNew</span><span class="p">(</span><span class="n">doSomething</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Otra opci√≥n, si el m√©todo tuviese un par√°metro int para especificar el n√∫mero de segundos (en lugar de ser aleatorio) podr√≠a ser esta:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="n">doSomething</span><span class="p">(</span><span class="kt">int</span> <span class="n">seconds</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">mseconds</span> <span class="p">=</span> <span class="n">seconds</span> <span class="p">*</span> <span class="m">1000</span>
    <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">mseconds</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="n">Task</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">StartNew</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">doSomething</span><span class="p">(</span><span class="m">5</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Aqu√≠ ya vemos algo m√°s curioso. Algo que seguramente hemos observado muchas veces y utilizado antes: <a href="http://msdn.microsoft.com/en-us/library/bb397687.aspx" target="_blank" rel="noopener noreffer">Una expresi√≥n lambda</a>. Esta expresi√≥n es tambi√©n algo tomado de la programaci√≥n funcional, y puede leerse como: ‚Äúva hacia‚Äù. En la parte izquierda de la expresi√≥n se especifican los  par√°metros de entrada o variables (si existen, en este caso no), y en la parte derecha la propia expresi√≥n. El caso anterior es tan simple que no tiene par√°metros y s√≥lo usamos la parte derecha de la expresi√≥n para enviar el valor 5 al m√©todo.</p>
<p>Al usar una expresi√≥n lambda se permite que las instrucciones contenidas en dicha expresi√≥n puedan varias l√≠neas, de modo que tambi√©n podemos llegar a hacer algo como esto:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">Task</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">StartNew</span><span class="p">(()</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
    <span class="n">doSomething</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;finished!&#34;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
<p>O directamente esto:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">Task</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">StartNew</span><span class="p">(()</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">mseconds</span> <span class="p">=</span> <span class="n">seconds</span> <span class="p">*</span> <span class="m">1000</span>
    <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">mseconds</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;finished!&#34;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
<p>En este caso, podemos incluso omitir el m√©todo doSomething y usar el c√≥digo inline directamente en la llamada a StartNew. No obstante, un consejo: No es conveniente abusar de las expresiones inline, de modo que si tenemos m√°s de 5 √≥ 6 l√≠neas tal vez ser√° m√°s conveniente refactorizar este c√≥digo para no hacerlo demasiado complejo y respetar los buenos principios de dise√±o.</p>
<h2 id="ahora-con-par√°metros">Ahora con par√°metros</h2>
<p>Hasta ahora al realizar la llamada siempre hemos usado un delegado de tipo Action sin par√°metros, de ah√≠ los par√©ntesis vac√≠os en la parte izquierda de la expresi√≥n lambda. Sin embargo encontraremos multitud de casos en los que debemos pasar par√°metros. Sin ir m√°s lejos el m√©todo Parallel.For tiene un par√°metro de tipo Action al que hay que pasarle un valor de tipo int, l√≥gico por otra parte ya que dentro de un bucle es muy necesario conocer en todo momento el valor de la iteraci√≥n:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">Parallel</span><span class="p">.</span><span class="n">For</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">40</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">serie</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">Fibonacci</span><span class="p">());</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Observar que no es necesario definir el tipo de datos de la variable i porque el propio compilador es capaz de inferirlo, pero evidentemente tambi√©n podemos declarar el tipo previo al nombre de la variable, como siempre (int i).</p>
<p>Podemos pasar tantos par√°metros como necesite la Action, el mismo m√©todo tiene otra sobrecarga que admite un objeto ParallelLoopState para poder cancelar el bucle:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">Parallel</span><span class="p">.</span><span class="n">For</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">40</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">loopState</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">serie</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">Fibonacci</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&gt;</span> <span class="m">35</span><span class="p">)</span> <span class="n">loopState</span><span class="p">.</span><span class="n">Break</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Y por supuesto podemos crearnos nuestras propias acciones con tantos par√°metros como sean necesarios. Aunque al igual que ante, si necesitamos pasar m√°s de 3 √≥ 4 par√°metros a un Action tal vez deber√≠amos plantearnos si estamos haciendo las cosas bien</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="n">saveToDatabase</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">useDetails</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">addLineToUserLog</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">useDetails</span><span class="p">)</span> <span class="n">addLineToUserLogDetails</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">void</span> <span class="n">test</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//Define una acci√≥n que apunta al m√©todo saveToDatabase
</span><span class="c1"></span>    <span class="n">Action</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;</span> <span class="n">myAction</span> <span class="p">=</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">saveToDatabase</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="p">};</span>
 
    <span class="kt">string</span> <span class="k">value</span> <span class="p">=</span> <span class="s">&#34;This is the value...&#34;</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">usedetails</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="n">myAction</span><span class="p">(</span><span class="k">value</span><span class="p">,</span> <span class="n">usedetails</span><span class="p">);</span> <span class="c1">//Aqu√≠ se llama a la acci√≥n y al m√©todo al que apunta
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="resumiendo">Resumiendo</h2>
<p>Los delegados de tipo Action son muy √∫tiles para simplificar el trabajo con delegados (ahora que lo pienso hace bastante tiempo que no los uso, ni para declarar eventos). Nos permiten especificar las acciones a realizar pudiendo llegar a tener hasta 16 par√°metros -demasiados en mi opini√≥n- y al igual que los m√©todo void no devuelven ning√∫n valor. Si queremos lo mismo pero pudiendo retornar un resultado debemos utilizar su hermano Func&lt;T, TResult&gt; que es exactamente igual, pero en todas sus sobrecargas (y tiene tantas como Action) el √∫ltimo argumento representa el valor de retorno.</p>
<p><a href="/es/parallelseries00-index" rel="">Ir al √≠ndice de la serie</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>El art√≠culo fue actualizado el 2012-02-08</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/es/luces-camara-action/index.md" target="_blank">Leer Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartir en Twitter" data-sharer="twitter" data-url="https://lluisfranco.github.io/es/luces-camara-action/" data-title="Luces, c√°mara... action!" data-via="lluisfranco" data-hashtags="csharp,net framework,Task,Parallel,Async"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Facebook" data-sharer="facebook" data-url="https://lluisfranco.github.io/es/luces-camara-action/" data-hashtag="csharp"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Linkedin" data-sharer="linkedin" data-url="https://lluisfranco.github.io/es/luces-camara-action/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en WhatsApp" data-sharer="whatsapp" data-url="https://lluisfranco.github.io/es/luces-camara-action/" data-title="Luces, c√°mara... action!" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Pinterest" data-sharer="pinterest" data-url="https://lluisfranco.github.io/es/luces-camara-action/" data-image="/images/posts/LightsCameraAction.png"><i class="fab fa-pinterest fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Reddit" data-sharer="reddit" data-url="https://lluisfranco.github.io/es/luces-camara-action/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Instapaper" data-sharer="instapaper" data-url="https://lluisfranco.github.io/es/luces-camara-action/" data-title="Luces, c√°mara... action!" data-description=""><i data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></i></a><a href="javascript:void(0);" title="Compartir en Pocket" data-sharer="pocket" data-url="https://lluisfranco.github.io/es/luces-camara-action/"><i class="fab fa-get-pocket fa-fw"></i></a><a href="javascript:void(0);" title="Compartir en Evernote" data-sharer="evernote" data-url="https://lluisfranco.github.io/es/luces-camara-action/" data-title="Luces, c√°mara... action!"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/es/tags/csharp/">csharp</a>,&nbsp;<a href="/es/tags/net-framework/">net framework</a>,&nbsp;<a href="/es/tags/task/">Task</a>,&nbsp;<a href="/es/tags/parallel/">Parallel</a>,&nbsp;<a href="/es/tags/async/">Async</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Regresar</a></span>&nbsp;|&nbsp;<span><a href="/es/">Inicio</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/es/parallelseries05-parallel-static-class/" class="prev" rel="prev" title="Parallel Series 05 - Parallel Static Class"><i class="fas fa-angle-left fa-fw"></i>Parallel Series 05 - Parallel Static Class</a>
            <a href="/es/functional-programming-for-the-rest-of-us/" class="next" rel="next" title="Programaci√≥n funcional para el resto de nosotros">Programaci√≥n funcional para el resto de nosotros<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/about/" target="_blank">llu√≠s</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript">
    window.config = {"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":20},"comment":{},"headerMode":{"desktop":"fixed","mobile":"auto"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/es/index.json","lunrLanguageCode":"es","maxResultLength":10,"noResultsFound":"No se encontraron resultados","snippetLength":30,"type":"lunr"}};
</script><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=html5shiv%2CElement.prototype.closest%2CrequestAnimationFrame%2CCustomEvent%2CPromise%2CObject.entries%2CObject.assign%2CObject.values%2Cfetch%2CElement.prototype.after%2CArray.prototype.fill%2CIntersectionObserver%2CArray.from%2CArray.prototype.find%2CMath.sign"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.es.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/object-fit-images/ofi.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
